
network:
    name: "InterestedParticipant"

server:
    name: "{{ server_name }}"

    listeners:
        ":6697":
            tls:
                cert: /etc/ergo/ssl/server.crt
                key: /etc/ergo/ssl/server.key
            proxy: false

    unix-bind-mode: 0777


    sts:
        enabled: false

        duration: 1mo2d5m

        port: 6697

        preload: false

    websockets:
        allowed-origins:
        - "https://{{ server_name }}"
        - "https://{{ server_name }}:443"

    casemapping: "ascii"

    enforce-utf8: true

    lookup-hostnames: true
    forward-confirm-hostnames: true

    check-ident: true

    # password: "__SERVER_PASSWORD_HASH__"

    motd: ergo.motd

    motd-formatting: true

    idle-timeouts:
        registration: 60s
        ping: 1m30s
        disconnect: 2m30s

    relaymsg:
        enabled: true

        separators: "/"

        available-to-chanops: true

    proxy-allowed-from:
        - localhost

    webirc:
        -
            password: "__WEBIRC_PASSWORD_HASH__"

            hosts:
                - localhost
                - 127.0.0.1
                - ::1

    max-sendq: 96k

    compatibility:
        force-trailing: true

        send-unprefixed-sasl: true

        allow-truncation: true

    ip-limits:
        count: true
        max-concurrent-connections: 16

        throttle: true
        window: 10m
        max-connections-per-window: 32

        cidr-len-ipv4: 32
        cidr-len-ipv6: 64

        exempted:
            - "localhost"

        custom-limits:

    ip-check-script:
        enabled: false
        command: "/usr/local/bin/check-ip-ban"
        args: []
        timeout: 9s
        kill-timeout: 1s
        max-concurrency: 64
        exempt-sasl: false

    ip-cloaking:
        enabled: false

        enabled-for-always-on: true

        netname: "irc"

        cidr-len-ipv4: 32

        cidr-len-ipv6: 64

        num-bits: 64

    secure-nets:

    oper-throttle: 10s

    suppress-lusers: false

    additional-isupport:

accounts:
    authentication-enabled: true

    registration:
        enabled: true

        allow-before-connect: true

        throttling:
            enabled: true
            duration: 10m
            max-attempts: 30

        bcrypt-cost: 4

        verify-timeout: "32h"

        email-verification:
            enabled: false
            sender: "admin@my.network"
            require-tls: true
            helo-domain: "my.network"
            address-blacklist:
            address-blacklist-syntax: "glob"
            timeout: 60s
            password-reset:
                enabled: false
                cooldown: 1h
                timeout: 1d

    login-throttling:
        enabled: true

        duration:  1m

        max-attempts: 3

    skip-server-password: true

    login-via-pass-command: false

    advertise-scram: true

    require-sasl:
        enabled: false

        exempted:
            - "localhost"

    nick-reservation:
        enabled: true

        additional-nick-limit: 2

        method: optional

        allow-custom-enforcement: true

        guest-nickname-format: "Guest-*"

        force-guest-format: true

        force-nick-equals-account: false

        forbid-anonymous-nick-changes: false

    multiclient:
        enabled: true

        allowed-by-default: false

        always-on: "disabled"

        auto-away: "opt-in"

    vhosts:
        enabled: true

        max-length: 64

        valid-regexp: '^[0-9A-Za-z.\-_/]+$'

    auth-script:
        enabled: false
        command: "/usr/local/bin/authenticate-irc-user"
        args: []
        autocreate: true
        timeout: 9s
        kill-timeout: 1s
        max-concurrency: 64

    oauth2:
        enabled: false
        autocreate: true
        auth-script: false
        introspection-url: "https://example.com/api/oidc/introspection"
        introspection-timeout: 10s
        client-id: "ergo"
        client-secret: "4TA0I7mJ3fUUcW05KJiODg"

    jwt-auth:
        enabled: false
        autocreate: true
        tokens:
            -
                algorithm: "hmac"
                key: "nANiZ1De4v6WnltCHN2H7Q"
                account-claims: ["preferred_username"]

channels:
    default-modes: +nt

    max-channels-per-client: 100

    operator-only-creation: false

    registration:
        enabled: true

        operator-only: true

        max-channels-per-account: 15

    list-delay: 0s

    invite-expiration: 24h

oper-classes:
    "chat-moderator":
        title: Chat Moderator

        capabilities:
            - "kill"
            - "ban"
            - "nofakelag"
            - "relaymsg"
            - "vhosts"
            - "sajoin"
            - "samode"
            - "snomasks"
            - "roleplay"

    "server-admin":
        title: Server Admin

        extends: "chat-moderator"

        capabilities:
            - "rehash"
            - "accreg"
            - "unregister"
            - "chanreg"
            - "history"
            - "defcon"
            - "massmessage"
            - "metadata"

opers:
    admin:
        class: "server-admin"

        hidden: false

        whois-line: is the server administrator

        vhost: "staff"

        password: "__OPER_PASSWORD_HASH__"

logging:
    -
        method: stderr

        type: "* -userinput -useroutput"

        level: info

debug:
    recover-from-errors: true

lock-file: "/etc/ergo/ircd.lock"

datastore:
    path: /var/lib/ergo/ircd.db

    autoupgrade: true

    mysql:
        enabled: true
        socket-path: "/var/run/mysqld/mysqld.sock"
        user: "{{ mysql_user }}"
        password: "__MYSQL_PASSWORD__"
        history-database: "{{ mysql_database }}"
        timeout: 3s
        max-conns: 4

languages:
    enabled: false

    default: en

    path: languages

limits:
    nicklen: 32

    identlen: 20

    realnamelen: 150

    channellen: 64

    awaylen: 390

    kicklen: 390

    topiclen: 390

    monitor-entries: 100

    whowas-entries: 100

    chan-list-modes: 100

    registration-messages: 1024

    multiline:
        max-bytes: 4096
        max-lines: 100

fakelag:
    enabled: true

    window: 1s

    burst-limit: 5

    messages-per-window: 2

    cooldown: 2s

    command-budgets:
        "CHATHISTORY": 16
        "MARKREAD":    16
        "MONITOR":     1
        "WHO":         4
        "WEBPUSH":     1

roleplay:
    enabled: false

    require-oper: false

    require-chanops: false

    add-suffix: true

extjwt:

history:
    enabled: true

    channel-length: 2048

    client-length: 256

    autoresize-window: 3d

    autoreplay-on-join: 0

    chathistory-maxmessages: 1000

    znc-maxmessages: 2048

    restrictions:
        expire-time: 1w

        query-cutoff: 'none'

        grace-period: 1h

    persistent:
        enabled: true

        unregistered-channels: false

        registered-channels: "opt-out"

        direct-messages: "opt-out"

    retention:
        allow-individual-delete: false

        enable-account-indexing: false

    tagmsg-storage:
        default: false

        whitelist:
            - "+draft/react"
            - "+react"

allow-environment-overrides: true

metadata:
    enabled: true
    max-subs: 100
    max-keys: 100
    client-throttle:
        enabled: true
        duration: 2m
        max-attempts: 10

webpush:
    enabled: false
    timeout: 10s
    delay: 0s
    max-subscriptions: 4
    expiration: 14d

api:
    enabled: false
    listener: "127.0.0.1:8089"
    bearer-tokens:
        - "example"
